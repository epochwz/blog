# HTTP

**HTTP协议：**计算机之间通过网络进行通信的规则，用于Web浏览器向Web服务器请求信息和服务

* **无连接：**每次连接只处理一个请求；服务器处理并响应客户端后会关闭TCP连接
  * 优点：请求时连接，请求完释放连接，以便尽快将资源释放，供其他客户端使用，节省传输时间
  * 缺点：当网页的图片数量剧增后，无连接特性导致每次访问图片都需要建立一次TCP连接，十分低效
  * `Keep-Alive`：保持客户端和服务端的连接持续有效，避免重复建立连接的消耗
* **无状态：**服务端仅仅是接收数据，响应数据，不保留客户端的请求信息，不保持连接状态
  * 优点：服务器压力小，不会造成不必要的连接占用
  * 缺点：每次请求都是独立的，无法保存会话状态，意味着后续请求都需要重新传输大量重复的内容信息
  * `Cookie`：通过客户端保持状态；服务器向客户端写入Cookie\(会话信息\)，浏览器保存Cookie，再次访问服务器时直接携带该会话信息
  * `Session`：通过服务端保持状态；但客户端访问服务器时，服务器根据需求设置客户端Session，将该会话信息保存在服务器上，同时将标识该Session的SessionId传递给客户端浏览器，浏览器保存该SessionId，当浏览器再次访问服务器时，会携带该SessionId，服务器据此获取客户端的数据信息，当客户端浏览器关闭时，该SessionId被清除

### HTTP响应

**HTTP响应：**服务端使用HTTP协议向客户端发送的响应信息

**HTTP响应的组成结构**

```java
1. 状态码：数字(请求结果的状态编号)+文字(请求结果的描述信息)，用于描述请求的结果(成功/失败)
2. 响应头：服务器类型、日期时间、内容类型、内容长度等信息
3. 响应体：响应正文，服务器响应的数据信息
```

**HTTP响应的状态码**

```
HTTP状态码由3位数字构成，其中首位数字定义了状态码类型
1XX：信息类，请求被正确接收，正在进一步处理中
2XX：响应成功，请求被正确接收、处理(200 OK)
3XX：重定向，请求失败，客户端需要采取进一步动作
4XX：客户端错误，表示客户端提交的请求有错误(404 NOT FOUND)
5XX：服务端错误，表示服务器不能完成对请求的处理(500)
```

### HTTP请求

**HTTP请求：**客户端通过HTTP协议向服务端发送的请求信息

**完整的HTTP请求过程**

```java
1. 建立TCP连接
2. Web浏览器向Web服务器发送请求命令
3. Web浏览器发送请求头信息
4. Web服务器响应
5. Web服务器发送响应头信息
6. Web服务器向浏览器发送数据
7. Web服务器关闭TCP连接
```

**HTTP请求的组成结构**

```java
1. 方法或动作：GET/POST
2. URL：请求地址和参数
3. 请求头：客户端环境信息、身份验证信息等
4. 请求体：客户端提交的查询字符串，表单信息等，又称请求正文
```

**HTTP请求的两种方式：GET/POST**

**GET**

* 一般用于**获取**服务器资源
* 发送的数据量小，不超过2kb/2000个字符
* 请求参数直接以字符串形式附加在URL后面\(URL和参数以?分隔，参数之间以&分隔\)，可以在地址栏看到，安全性低
* **幂等性：**执行一次GET请求得到的结果和请求n次GET请求得到的结果是相等的

**POST**

* 一般用于**修改**服务器资源
* 发送的数据量无限制\(取决于服务器限制\)
* 请求参数放在请求头中进行传输，安全性高

### Web服务器的实现原理

浏览器负责的工作:
1. 向远程服务器发送请求
2. 读取远程服务器返回的字符串数据
3. 负责根据字符串数据渲染出HTML页面

Web服务器工作步骤:
1. 启动单独线程
2. 使用IO流读取用户请求的二进制流数据
3. 解析请求参数
4. 处理用户请求
5. 生成响应数据
6. 使用IO流向客户端发送请求数据

Web服务器负责完成多线程、网络通信等通用的底层功能\[1、2、6步\]，并调用Servlet来完成解析参数、处理请求、生成响应等业务功能\[3、4、5步\]

### HTML页面提交请求的两种方式

**使用超链接：**只支持GET请求，可以包含请求参数，但不能收集用户输入

**提交表单：**支持GET/POST请求，可以让用户输入请求参数

* 表单一旦提交，会将有name属性的表单控件转换成请求参数
* 请求参数和表单域的关系如下:
  1. 每个有name属性的表单域对应一个请求参数
  2. 若有多个表单域有相同name属性，则只生成一个有多个值的请求参数
  3. 表单域的name指定参数名，value指定参数值
  4. 设置了disabled="disabled"的表单域不再生成请求参数
