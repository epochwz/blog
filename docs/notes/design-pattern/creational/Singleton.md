# 单例模式

类型：创建型

定义：保证一个类只有一个实例，并提供一个全局访问点

优点

- 在内存中只有一个实例，减少了内存开销 (避免频繁创建和销毁对象)
- 可以避免对资源的多重占用 (比如写文件)
- 设置了全局访问点，严格控制访问

- 节省内存和计算
- 保证结果正确
- 方便管理

缺点：没有接口，扩展困难

实现
- 私有构造器
- 全局访问点

注意

- 延迟加载
- 线程安全

破坏

- 反序列化
- 反射调用
- 克隆调用

适用场景

- 希望确保任何情况下都绝对只有一个实例 (网站计数器、线程池、数据库连接池)
- 无状态工具类
- 全局信息类

## 实现方式

### 懒汉式

#### 双重空检查

解决线程安全问题

- 添加 synchronized 关键字，同步锁消耗资源大，作用范围大(用于 static 方法时锁住的是整个类)
- 双重检查 + 使用 volatile 禁止指令重排序
  - 解决线程安全性能问题：延迟加锁，双重空检查 --> 只需要在实例未创建完成时进行一次加锁，而懒汉式则每次都加锁
  - 解决指令重排序的问题
    - 添加 volatile 关键字禁止指令重排序
    - 屏蔽指令重排序：基于静态内部类，使的对象的构造过程不被外部所见，是否进行指令重排序都不产生影响

#### 静态内部类

JVM 在类的初始化阶段 (Class 被 JVM 加载之后，被线程使用之前)，JVM 会获取一个 “Class 对象的初始化锁”，可以同步多个线程对一个类的初始化

首次发生以下五种情况时，一个类会被立刻初始化 (执行类的静态初始化、初始化类中声明的静态变量)

- 类的实例被创建
- 类的静态方法被调用
- 类的静态变量被赋值
- 类的静态变量被使用 (且这个变量不是常量)
- 类是一个顶级类，并且在该类中有嵌套的断言语句

### 饿汉式

#### 普通饿汉式

#### 单实例枚举

## 单例模式和静态类的区别

## 相关模式

- 工厂模式：使用 单例模式 实现
- 享元模式：获取 单例模式 对象 (相当于单例类的工厂类)