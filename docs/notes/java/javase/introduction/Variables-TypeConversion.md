# 变量的类型转换

## 基本数据类型的类型转换

### 自动类型转换

**自动类型转换**：将 `表数范围小的数值 / 变量` 赋值给 `表数范围大的变量` 时，是一种安全的操作，因此系统会进行 *自动类型转换*

- `byte -> short -> int -> long -> float -> double`
  - 整型转换成浮点型时会有精度丢失问题 `float f = 123456789L; // 1.23456792E8`
- `char -> int`
- 任何基本数据类型和字符串进行连接运算时，基本数据类型值自动转换为字符串类型
- **表达式类型自动提升**： 如果算术表达式中包含多个基本类型的值，那么整个算术表达式的数据类型将发生自动提升。

  - 表达式中的 `byte` `short` `char` 类型一定会自动提升成 `int` 类型
  - 表达式最终的数据类型会自动提升到表达式中出现的最高等级的数据类型
  - 示例

      ```java
      byte b = 1;
      short s = 2;
      // 编译出错：当表达式出现多个数据类型时，byte short char 全都会自动提升成 int 类型，因此表达式最终是 int 类型的
      // short result = b + s;
      int result = b + s; // 编译通过

      // 编译出错：表达式中最高等级的数据类型是 double 类型，因此表达式最终是 double 类型的，无法赋值给 int 类型变量
      // int i = b + s + 0.0;
      double d = b + s + 0.0; // 编译通过
      ```

### 强制类型转换

**强制类型转换**：将 `表数范围大的数值 / 变量` 赋值给 `表数范围小的变量` 时，可能造成溢出，是一种不安全的操作，因此系统不会进行自动类型转换，而是需要通过 `(TypeA)TypeB` 的方式显式的进行 *强制类型转换*

- 强制类型转换可能会发生溢出，从而造成数据丢失：例如 将 `double` 强制转换为 `int` 时会截取整数部分
- 基本数据类型之间的强制类型转换只能在数值类型之间进行『整数型、浮点型、字符型，不包括布尔型』

## 引用数据类型的类型转换

### 自动类型转换（向上转型）

**向上转型**：将父类引用指向子类实例

- 子类实例是父类的特殊实例，因此向上转型是一种安全的操作，所以系统支持 *自动类型转换*

#### 方法和调用类之间的 “绑定” 过程

**绑定**：将 一个方法调用 同 一个方法所属的类 链接到一起的过程，称为 “绑定”

- 静态绑定：由 编译器和链接程序 在 程序运行之前 就确定好调用哪个方法
- 动态绑定：由 JVM 在 程序运行期间 根据对象的运行时类型判断应该调用哪个类的方法
- 代码示例

    ```java
    public class Test {
        public static void main(String[] args) {
            // 静态绑定：编译期就能够确定使用哪个类调用方法
            Cat cat = new Cat();
            cat.hello();
            Dog dog = new Dog();
            dog.hello();

            // 动态绑定：编译期不能够确定使用哪个类调用方法
            Animal animal = randomAnimal((int) (Math.random() * 3));
            animal.hello();
        }

        private static Animal randomAnimal(int kind) {
            switch (kind) {
                case 1:
                    return new Cat();
                case 2:
                    return new Dog();
                default:
                    return new Animal();
            }
        }
    }
    ```

**向上转型和动态绑定是实现多态的基础**：向上转型实现了将子类对象转换成父类类型，而动态绑定能够识别出对象的原始数据类型，从而调用相应的类的方法

### 强制类型转换（向下转型）

**向下转型**：将子类引用指向父类实例

- 如果父类实例的运行时类型不是子类引用的数据类型或其子类，则会导致运行时出现 `ClassCastException`
- 因此向下转型是一种不安全的操作，所以系统不支持自动类型转换，需要显式进行*强制类型转换*
- 引用数据类型之间的强制类型转换只能在具有 相同接口 或者 继承关系 的两个类型之间进行
